"use strict";(self.webpackChunkchat_2_db=self.webpackChunkchat_2_db||[]).push([[1001,1180],{1001:(e,t,i)=>{i.r(t),i.d(t,{dyte_pip_toggle:()=>c});var s=i(67503),a=i(36881),o=i(51922),n=i(51306),r=(i(60804),i(21237)),d=i(86466);const c=class{constructor(e){(0,s.r)(this,e),this.stateUpdate=(0,s.c)(this,"dyteStateUpdate",7),this.variant="button",this.meeting=void 0,this.states=void 0,this.config=a.d,this.iconPack=o.d,this.size=void 0,this.t=(0,n.u)(),this.pipEnabled=!1,this.pipSupported=!1}connectedCallback(){this.meetingChanged(this.meeting)}disconnectedCallback(){}statesChanged(e){const t=e||d.s;null!=(null==t?void 0:t.activePipMode)&&(this.pipEnabled=t.activePipMode)}meetingChanged(e){var t;if(null===e)return;this.pipSupported=r.s.isSupported()&&(null===(t=e.self.config)||void 0===t?void 0:t.pipMode);const i=this.states||d.s;this.pipEnabled=i.activePipMode}togglePip(){const e=this.states||d.s,{activePipMode:t}=e;!0!==t?(r.s.updateMediaSession(r.P.CAMERA,this.meeting.self.videoEnabled),r.s.updateMediaSession(r.P.MIC,this.meeting.self.audioEnabled),r.s.enable(),this.stateUpdate.emit({activePipMode:!0})):(r.s.disable(),this.stateUpdate.emit({activePipMode:!1})),this.stateUpdate.emit({activeMoreMenu:!1}),d.s.activeMoreMenu=!1}render(){if(this.pipSupported)return(0,s.h)(s.H,{tabIndex:0,role:"log","aria-label":"Picture-in-Picture mode"},(0,s.h)("dyte-controlbar-button",{part:"controlbar-button",size:this.size,iconPack:this.iconPack,t:this.t,onClick:()=>this.togglePip(),icon:this.pipEnabled?this.iconPack.pip_on:this.iconPack.pip_off,label:this.pipEnabled?this.t("pip_off"):this.t("pip_on"),variant:this.variant}))}static get watchers(){return{states:["statesChanged"],meeting:["meetingChanged"]}}};c.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);display:block}"},21237:(e,t,i)=>{i.d(t,{P:()=>n,s:()=>r});const s=720,a=1280,o=(e,t,i,s,a,o)=>{const n=a,r=o,d=Math.min(i/n,s/r);let c,h,u,v,l=n*d,p=r*d,m=1;return l<i&&(m=i/l),Math.abs(m-1)<1e-14&&p<s&&(m=s/p),l*=m,p*=m,u=n/(l/i),v=r/(p/s),c=.5*(n-u),h=.5*(r-v),c<0&&(c=0),h<0&&(h=0),u>n&&(u=n),v>r&&(v=r),[c,h,u,v,e,t,i,s]};var n;!function(e){e.CAMERA="CAMERA",e.MIC="MIC",e.END="END"}(n||(n={}));const r=new class{constructor(){this.tracks=[],this.sources=[],this.enabled=!1}isSupported(){return!!window.chrome&&document.pictureInPictureEnabled}cleanup(){this.isSupported()&&void 0!==document.exitPictureInPicture&&null!==document.pictureInPictureElement&&document.exitPictureInPicture(),this.canvas=void 0,this.video=void 0,this.tracks=[],this.request=void 0}createCanvas(){const e=document.createElement("canvas");e.height=s,e.width=a,this.canvas=e}setupEvents(e){void 0!==navigator.mediaSession&&void 0!==navigator.mediaSession.setCameraActive&&navigator.mediaSession.setActionHandler("hangup",(()=>{e(n.END)}))}mountAudioEvents(e){void 0!==navigator.mediaSession&&void 0!==navigator.mediaSession.setCameraActive&&navigator.mediaSession.setActionHandler("togglemicrophone",(()=>{e(n.MIC)}))}mountVideoEvents(e){void 0!==navigator.mediaSession&&void 0!==navigator.mediaSession.setCameraActive&&navigator.mediaSession.setActionHandler("togglecamera",(()=>{e(n.CAMERA)}))}unmountAudioEvents(){void 0!==navigator.mediaSession&&void 0!==navigator.mediaSession.setCameraActive&&navigator.mediaSession.setActionHandler("togglemicrophone",void 0)}unmountVideoEvents(){void 0!==navigator.mediaSession&&void 0!==navigator.mediaSession.setCameraActive&&navigator.mediaSession.setActionHandler("togglecamera",void 0)}drawGrid(e,t,i){if(void 0===this.canvas)return;const n=this.canvas.getContext("2d");n.fillStyle="#000000",n.fillRect(0,0,a,s);let r=0,d=0;for(;r<715;){let s=0;for(;s<1275&&d<i;){const i=this.tracks[d],[a,c,h,u,v,l,p,m]=o(s,r,e,t,i.videoWidth,i.videoHeight);n.drawImage(i,a,c,h,u,v,l,p,m),d+=1,s+=e}r+=t}}paintCanvas(){const e=this.tracks.length,[t,i]=(e=>{switch(e){case 0:case 1:return[a,s];case 2:return[Math.floor(640),s];case 3:case 4:return[Math.floor(640),Math.floor(360)];default:return[Math.floor(426.6666666666667),Math.floor(360)]}})(e);this.drawGrid(t,i,e)}animate(){void 0!==this.tracks&&this.paintCanvas(),void 0!==this.request&&(this.request=requestAnimationFrame((()=>this.animate())))}create(e,t,i){this.cleanup(),this.createCanvas(),this.setupEvents(i);const o=document.createElement("video");o.height=s,o.width=a,o.autoplay=!0,o.srcObject=this.canvas.captureStream(24),this.video=o,this.video.onloadedmetadata=()=>{try{e(),this.video.onleavepictureinpicture=()=>{t()}}catch(i){t(i.getMessage())}},this.paintCanvas()}updateMediaSession(e,t){void 0!==navigator.mediaSession&&(e===n.CAMERA&&void 0!==navigator.mediaSession.setCameraActive&&navigator.mediaSession.setCameraActive(t),e===n.MIC&&void 0!==navigator.mediaSession.setMicrophoneActive&&navigator.mediaSession.setMicrophoneActive(t))}updateVideoSources(){const e=Object.values(this.sources).filter((e=>e.enabled)),t=[];e.map((e=>{t.push(e.element)})),this.tracks=t}enableSource(e){void 0!==this.sources[e]&&(this.sources[e].enabled=!0),this.updateVideoSources()}disableSource(e){void 0!==this.sources[e]&&(this.sources[e].enabled=!1),this.updateVideoSources()}addSource(e,t,i){this.sources[e]={element:t,enabled:i}}removeSource(e){delete this.sources[e]}removeAllSource(){this.sources=[]}enable(){this.enabled=!0,this.request=requestAnimationFrame((()=>this.animate())),this.video.requestPictureInPicture()}disable(){this.enabled=!1,cancelAnimationFrame(this.request),this.request=void 0,document.exitPictureInPicture()}}}}]);