"use strict";(self.webpackChunkchat_2_db=self.webpackChunkchat_2_db||[]).push([[597,4847],{50597:(t,e,i)=>{i.r(e),i.d(e,{dyte_participants_audio:()=>n});var a=i(67503),s=i(86386),r=i(51306),d=i(51922);class o{constructor(){this.audio=document.createElement("audio"),this.audio.autoplay=!0,this.audioStream=new MediaStream,this.audio.srcObject=this.audioStream,this.audioTracks=[]}addTrack(t,e){this.audioTracks.some((e=>e.id===t))||(this.audioTracks.push({id:t,track:e}),this.audioStream.addTrack(e),this.play())}removeTrack(t){const e=this.audioTracks.find((e=>e.id===t));null!=e&&(this.audioStream.removeTrack(e.track),this.audioTracks=this.audioTracks.filter((e=>e.id!==t)))}async play(){var t;this.audio.srcObject=this.audioStream,await(null===(t=this.audio.play())||void 0===t?void 0:t.catch((t=>{"NotAllowedError"===t.name?null!=this._onError&&this._onError():"AbortError"!==t.name&&s.l.error("[dyte-audio] play() error\n",t)})))}async setDevice(t){var e,i,a;await(null===(a=null===(i=(e=this.audio).setSinkId)||void 0===i?void 0:i.call(e,t))||void 0===a?void 0:a.catch((t=>{s.l.error("[dyte-audio] setSinkId() error\n",t)})))}onError(t){this._onError=t}}const n=class{constructor(t){(0,a.r)(this,t),this.dialogClose=(0,a.c)(this,"dialogClose",7),this.onDyteDialogClose=()=>{this.showPlayDialog=!1,this.dialogClose.emit()},this.meeting=void 0,this.iconPack=d.d,this.t=(0,r.u)(),this.showPlayDialog=!1}componentDidLoad(){this.meetingChanged(this.meeting)}disconnectedCallback(){var t;null!=this.meeting&&(this.audioUpdateListener&&this.meeting.participants.joined.removeListener("audioUpdate",this.audioUpdateListener),this.screenShareUpdateListener&&this.meeting.participants.joined.removeListener("screenShareUpdate",this.screenShareUpdateListener),this.participantLeftListener&&this.meeting.participants.joined.removeListener("participantLeft",this.participantLeftListener),this.deviceUpdateListener&&this.meeting.self.removeListener("deviceUpdate",this.deviceUpdateListener),this.stageStatusUpdateListener&&(null===(t=this.meeting.stage)||void 0===t||t.removeListener("stageStatusUpdate",this.stageStatusUpdateListener)))}handleAudioError(){this.audio=new o,this.audio.onError((()=>{this.showPlayDialog=!0})),this.audio.play()}async meetingChanged(t){var e;if(null!=t){"LIVESTREAM"===t.meta.viewType&&"ON_STAGE"!==t.stage.status?(this.stageStatusUpdateListener=t=>{"ON_STAGE"===t&&this.handleAudioError()},null===(e=t.stage)||void 0===e||e.on("stageStatusUpdate",this.stageStatusUpdateListener)):this.handleAudioError();const i=t.self.getCurrentDevices();null!=i.speaker&&await this.audio.setDevice(i.speaker.deviceId),this.audioUpdateListener=({id:t,audioEnabled:e,audioTrack:i})=>{const a=`audio-${t}`;e&&null!=i?this.audio.addTrack(a,i):this.audio.removeTrack(a)};{const e=t.participants.joined.toArray();for(const t of e)this.audioUpdateListener(t)}this.participantLeftListener=({id:t})=>{this.audio.removeTrack(`audio-${t}`),this.audio.removeTrack(`screenshare-${t}`)},this.screenShareUpdateListener=({id:t,screenShareEnabled:e,screenShareTracks:i})=>{const a=`screenshare-${t}`;e&&null!=i.audio?this.audio.addTrack(a,i.audio):this.audio.removeTrack(a)},this.deviceUpdateListener=({device:t,preview:e})=>{e||"audiooutput"===t.kind&&this.audio.setDevice(t.deviceId)},t.participants.joined.addListener("audioUpdate",this.audioUpdateListener),t.participants.joined.addListener("screenShareUpdate",this.screenShareUpdateListener),t.participants.joined.addListener("participantLeft",this.participantLeftListener),t.self.addListener("deviceUpdate",this.deviceUpdateListener)}}render(){return(0,a.h)(a.H,null,this.showPlayDialog&&(0,a.h)("dyte-dialog",{open:!0,onDyteDialogClose:this.onDyteDialogClose,hideCloseButton:!0,iconPack:this.iconPack,t:this.t},(0,a.h)("div",{class:"modal"},(0,a.h)("h3",null,this.t("audio_playback.title")),(0,a.h)("p",null,this.t("audio_playback.description")),(0,a.h)("dyte-button",{kind:"wide",onClick:()=>{this.audio.play(),this.onDyteDialogClose()},title:this.t("audio_playback"),iconPack:this.iconPack,t:this.t},this.t("audio_playback")))))}static get watchers(){return{meeting:["meetingChanged"]}}};n.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);display:block;color:rgb(var(--dyte-colors-text-1000, 255 255 255))}.modal{box-sizing:border-box;width:100%;max-width:var(--dyte-space-96, 384px);padding:var(--dyte-space-4, 16px);border-radius:var(--dyte-border-radius-md, 8px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity))}.modal h3{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px);font-size:24px;font-weight:500}.modal p{margin-top:var(--dyte-space-4, 16px);margin-bottom:var(--dyte-space-6, 24px)}.modal dyte-button{width:100%}"}}]);