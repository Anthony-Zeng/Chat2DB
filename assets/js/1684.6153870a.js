"use strict";(self.webpackChunkchat_2_db=self.webpackChunkchat_2_db||[]).push([[1684],{2270:(e,t,i)=>{i.d(t,{g:()=>s,h:()=>a,p:()=>n});i(5114);const n=e=>{let t=null;try{const i=JSON.parse(e.message),{target:n,message:s}=i;t=void 0===n||void 0===s?e:Object.assign(Object.assign({},e),{targetUserIds:n,message:s})}catch(i){t=e}return t};function s(e){return e.sort(((e,t)=>e.localeCompare(t))).join("_")}function a(e,t){if(null!=e)for(const i of e)if("file"===i.kind){const e=i.getAsFile();i.type.startsWith("image/")?t("image",e):t("file",e)}}},3367:(e,t,i)=>{var n;i.d(t,{R:()=>n}),function(e){e.REQUEST_RECEIVED="REQUEST_RECEIVED",e.REQUEST_SENT="REQUEST_SENT",e.INCOMING_REQUEST_ACCEPTED="INCOMING_REQUEST_ACCEPTED",e.OUTGOING_REQUEST_ACCEPTED="OUTGOING_REQUEST_ACCEPTED",e.INCOMING_REQUEST_ENDED="INCOMING_REQUEST_ENDED",e.OUTGOING_REQUEST_ENDED="OUTGOING_REQUEST_ENDED"}(n||(n={}))},1684:(e,t,i)=>{i.r(t),i.d(t,{dyte_notifications:()=>m});var n=i(7503),s=i(3367),a=i(1007),o=i(2906),d=i(5461),c=i(1810),r=i(6881),h=i(2270),p=i(579);i(6386),i(5114),i(804),i(614);const l=2e3,u=Object.freeze({notifications:{participant_joined:!0,participant_left:!0,participant_joined_waitlist:!0,chat:!0,polls:!0,webinar:!0,tab_sync:!0},notification_sounds:{participant_joined:!0,participant_left:!0,chat:!0,polls:!0,webinar:!0,participant_joined_waitlist:!0},notification_duration:{participant_joined:2100,participant_left:2100,participant_joined_waitlist:4e3,chat:l,polls:l,webinar:l,tab_sync:l},participant_joined_sound_notification_limit:10,participant_chat_message_sound_notification_limit:10});function g(e){return Object.keys(e).filter((t=>e[t]))}const m=class{constructor(e){(0,n.r)(this,e),this.permissions=u,this.enabledSounds=g(u.notification_sounds),this.addStagePeersListeners=e=>{e.participants.joined.addListener("participantJoined",this.participantJoinedListener),e.meta.addListener("disconnected",this.networkDisconnectedListener),e.meta.addListener("connected",this.networkConnectedListener),e.participants.joined.addListener("participantLeft",this.participantLeftListener)},this.removeStagePeersListeners=e=>{e.participants.joined.removeListener("participantJoined",this.participantJoinedListener),e.meta.removeListener("disconnected",this.networkDisconnectedListener),e.meta.removeListener("connected",this.networkConnectedListener),e.participants.joined.removeListener("participantLeft",this.participantLeftListener)},this.onRemoteUpdate=({payload:e,type:t})=>{if(t===s.R.INCOMING_REQUEST_ACCEPTED){let t=this.meeting.participants.joined.get(e.request.remotePeerId);this.add({id:`message-${Math.random().toString(36)}`,icon:this.iconPack.chat,message:`Granted remote control to ${t.name}`,duration:l})}if(t===s.R.OUTGOING_REQUEST_ACCEPTED){let t=this.meeting.participants.joined.get(e.request.hostPeerId);this.add({id:`message-${Math.random().toString(36)}`,icon:this.iconPack.chat,message:`${t.name} has granted remote control.`,duration:l})}if(t===s.R.REQUEST_RECEIVED){let t=this.meeting.participants.joined.get(e.request.remotePeerId);this.add({id:`message-${Math.random().toString(36)}`,icon:this.iconPack.chat,message:`${t.name} has requested for remote control.`,duration:l})}if(t!==s.R.INCOMING_REQUEST_ENDED&&t!==s.R.OUTGOING_REQUEST_ENDED||this.add({id:`message-${Math.random().toString(36)}`,icon:this.iconPack.chat,message:"Existing remote control has been terminated.",duration:l}),t===s.R.REQUEST_SENT){let t=this.meeting.participants.joined.get(e.request.hostPeerId);this.add({id:`message-${Math.random().toString(36)}`,icon:this.iconPack.chat,message:`Sent remote control request to ${t.name}`,duration:l})}},this.onDyteNotification=e=>{this.add(e.detail);const t=e.detail.playSound;null!=t&&this.audio.play(t)},this.onRecordingUpdate=e=>{"RECORDING"===e?this.add({id:"recording-started",icon:this.iconPack.recording,message:this.t("recording.started"),duration:l}):"STOPPING"===e&&this.add({id:"recording-stopped",icon:this.iconPack.stop_recording,message:this.t("recording.stopped"),duration:l})},this.meeting=void 0,this.states=void 0,this.config=r.d,this.t=(0,c.u)(),this.size=void 0,this.iconPack=d.d,this.notifications=[]}connectedCallback(){"undefined"!=typeof document&&(null===document||void 0===document||document.addEventListener("dyteNotification",this.onDyteNotification)),this.meetingChanged(this.meeting),this.configChanged(this.config),this.statesChanged(this.states)}clearListeners(e){var t,i,n,s,a,o,d,c,r;const h="LIVESTREAM"===e.meta.viewType;(h&&"ON_STAGE"===(null===(t=e.stage)||void 0===t?void 0:t.status)||!h)&&this.removeStagePeersListeners(e),this.chatUpdateListener&&(null===(i=e.chat)||void 0===i||i.removeListener("chatUpdate",this.chatUpdateListener)),this.pollUpdateListener&&(null===(n=e.polls)||void 0===n||n.removeListener("pollsUpdate",this.pollUpdateListener)),this.socketDisconnectedListener&&e.meta.removeListener("socketDisconnected",this.socketDisconnectedListener),this.socketReconnectFailureListener&&e.meta.removeListener("socketReconnectFailure",this.socketReconnectFailureListener),this.socketReconnectedListener&&e.meta.removeListener("socketReconnected",this.socketReconnectedListener),this.socketReconnectingListener&&e.meta.removeListener("socketReconnecting",this.socketReconnectingListener),this.socketFailureListener&&e.meta.removeListener("socketFailure",this.socketFailureListener),this.stageRequestAccepted&&(null===(s=e.stage)||void 0===s||s.removeListener("stageRequestApproved",this.stageRequestAccepted)),this.stageRequestRejected&&(null===(a=e.stage)||void 0===a||a.removeListener("stageRequestRejected",this.stageRequestRejected)),this.newStageRequests&&(null===(o=e.stage)||void 0===o||o.removeListener("newStageRequest",this.newStageRequests)),this.stageStatusUpdateListener&&(null===(d=e.stage)||void 0===d||d.removeListener("stageStatusUpdate",this.stageStatusUpdateListener)),null===(c=e.remote)||void 0===c||c.removeListener("remoteUpdate",this.onRemoteUpdate),null===(r=e.recording)||void 0===r||r.removeListener("recordingUpdate",this.onRecordingUpdate),clearTimeout(this.disconnectTimeout)}disconnectedCallback(){var e;"undefined"!=typeof document&&(null===document||void 0===document||document.removeEventListener("dyteNotification",this.onDyteNotification)),null!=this.meeting&&(this.clearListeners(this.meeting),this.waitlistedParticipantJoinedListener&&this.meeting.participants.waitlisted.removeListener("participantJoined",this.waitlistedParticipantJoinedListener),this.spotlightTabUpdateListener&&(null===(e=this.meeting.spotlight)||void 0===e||e.removeListener("activeTabUpdate",this.spotlightTabUpdateListener)),this.peerRequestToJoinStateListener&&this.meeting.participants.joined.removeListener("peerRequestToJoinStage",this.peerRequestToJoinStateListener),this.peerAcceptedToJoinStageListener&&this.meeting.participants.joined.removeListener("peerAcceptedToJoinStage",this.peerAcceptedToJoinStageListener),this.peerRejectedToJoinStageListener&&this.meeting.participants.joined.removeListener("peerRejectedToJoinStage",this.peerRejectedToJoinStageListener))}meetingChanged(e,t){var i,n,s,d,c,r,l,u,g;if(clearTimeout(this.disconnectTimeout),void 0!==t&&this.clearListeners(t),null==e)return;const m="LIVESTREAM"===e.meta.viewType;this.audio=new a.D;const{notifications:_,notification_duration:v,notification_sounds:f}=this.permissions;this.participantJoinedListener=e=>{_.participant_joined&&this.add({id:`${e.id}-joined`,message:`${(0,o.f)(e.name)} just joined`,image:e.picture,duration:v.participant_joined}),f.participant_joined&&this.canPlayParticipantJoinedSound()&&this.audio.play("joined")},this.participantLeftListener=e=>{_.participant_left&&this.add({id:`${e.id}-left`,message:`${(0,o.f)(e.name)} left`,image:e.picture,duration:v.participant_left}),f.participant_left&&this.canPlayParticipantJoinedSound()&&this.audio.play("left")},this.waitlistedParticipantJoinedListener=e=>{const t=`${e.id}-joined-waitlist`;this.add({id:t,message:`${(0,o.f)(e.name)} is requesting to join the meeting`,image:e.picture,duration:v.participant_joined_waitlist,button:{text:"Accept",variant:"secondary",onClick:async()=>{await this.meeting.participants.acceptWaitingRoomRequest(e.id),this.remove(t)}}}),f.participant_joined_waitlist&&this.canPlayParticipantJoinedSound()&&this.audio.play("message")},this.chatUpdateListener=({message:t})=>{const i=(0,h.p)(t);if(null!=i){if(i.userId===e.self.userId)return;"text"===i.type&&(_.chat&&this.add({id:`message-${Math.random().toString(36)}`,icon:this.iconPack.chat,message:`${i.displayName}: ${(0,o.s)(i.message,20)}`,duration:v.chat}),f.chat&&this.canPlayChatSound()&&this.audio.play("message"))}},this.pollUpdateListener=({polls:e,newPoll:t})=>{!1!==t&&(_.polls&&this.meeting.self.userId!==e[e.length-1].createdByUserId&&this.add({id:`poll-${Math.random().toString(36)}`,icon:this.iconPack.poll,message:`New poll created by ${e[e.length-1].createdBy}`,duration:v.polls}),f.polls&&this.meeting.self.userId!==e[e.length-1].createdByUserId&&this.canPlayChatSound()&&this.audio.play("message"))},this.deviceUpdateListener=({device:e,preview:t})=>{t||("audiooutput"===e.kind?(this.audio.setDevice(e.deviceId),this.add({id:`speaker-switched-${e.deviceId}`,message:`Connected to ${e.label}`,icon:this.iconPack.speaker,duration:5e3})):"videoinput"===e.kind?this.add({id:`camera-switched-${e.deviceId}`,message:`Connected to ${e.label}`,icon:this.iconPack.speaker,duration:5e3}):this.add({id:`mic-switched-${e.deviceId}`,message:`Connected to ${e.label}`,icon:this.iconPack.mic_on,duration:5e3}))},this.networkDisconnectedListener=()=>{let e;this.remove("network"),e=2e4,this.add({id:"network",icon:this.iconPack.disconnected,message:this.t("Connection lost. Trying to reconnect..."),duration:2e4}),this.disconnectTimeout=setTimeout((()=>{this.add({id:"network-lost",icon:this.iconPack.disconnected,message:this.t("Taking too long to reconnect..."),button:{text:this.t("End Meeting"),variant:"danger",onClick:()=>{var e;return null===(e=this.meeting)||void 0===e?void 0:e.leaveRoom()}}})}),2e4)},this.networkConnectedListener=()=>{let e;this.remove("network"),this.remove("network-lost"),e=3e3,this.add({id:"network",icon:this.iconPack.wifi,message:this.t("Connection restored"),duration:3e3}),clearTimeout(this.disconnectTimeout)},this.socketUpdateListener=({event:e,attempt:t})=>{this.remove("socket"),"reconnected"===e?(this.remove("socketReconnecting"),this.add({id:"socket",icon:this.iconPack.wifi,message:this.t("Connection restored"),duration:3e3})):"disconnected"===e?this.add({id:"socket",icon:this.iconPack.disconnected,message:this.t("Connection lost"),duration:3e3}):"reconnecting"===e?this.add({id:"socketReconnecting",icon:this.iconPack.disconnected,message:this.t("Connection lost. Please check your network connection.")}):"reconnectFailure"===e?t>5&&(this.remove("socketReconnecting"),this.add({id:"socketReconnecting",icon:this.iconPack.disconnected,message:this.t("Taking too long to reconnect. Please check your network connection."),button:{text:this.t("End Meeting"),variant:"danger",onClick:()=>{var e;return null===(e=this.meeting)||void 0===e?void 0:e.leaveRoom()}}})):"failed"===e&&(this.remove("socketReconnecting"),this.add({id:"socketFailed",icon:this.iconPack.disconnected,message:this.t("Could not reconnect. Please leave the meeting and try refreshing the window.")}),this.add({id:"leaveMeeting",icon:this.iconPack.warning,message:this.t("Automatically leaving the meeting in 10 seconds.")}),setTimeout((()=>{var e;null===(e=this.meeting)||void 0===e||e.leaveRoom("disconnected")}),1e4))},this.spotlightTabUpdateListener=t=>{if(_.tab_sync)switch(t.type){case"plugin":const i=e.plugins.active.toArray().find((e=>e.id==t.id));null!=i&&this.add({id:"spotlight",message:`Plugin switched to ${i.name}`,duration:v.participant_joined});break;case"screenshare":const n=e.participants.joined.toArray().filter((e=>e.screenShareEnabled)).find((e=>e.id==t.id));null!=n&&this.add({id:"spotlight",message:`Now watching ${n.name}'s screen`,duration:v.webinar})}},this.peerRequestToJoinStateListener=({id:e})=>{if(!_.webinar)return;const t=this.meeting.participants.joined.get(e);void 0!==t&&(this.add({id:`webinar-request-${e}`,message:`${t.name} is requesting to be on stage`,duration:v.webinar,button:{text:"Accept",variant:"primary",onClick:async()=>{await this.meeting.participants.acceptAllRequestToJoinStageRequests([{id:e,requestToJoinType:"REQUEST_TO_PRESENT"}]),this.remove(`webinar-request-${e}`)}}}),f.webinar&&this.audio.play("joined"))},this.peerAcceptedToJoinStageListener=e=>{if(!_.webinar)return;const t=this.meeting.participants.joined.get(e.id);void 0!==t&&(this.add({id:`webinar-accepted-${e.id}`,message:`Approved ${t.name}'s request to join stage.`,duration:v.webinar}),f.webinar&&this.audio.play("joined"))},this.peerRejectedToJoinStageListener=e=>{if(!_.webinar)return;const t=this.meeting.participants.joined.get(e.id);void 0!==t&&this.add({id:`webinar-rejected-${e.id}`,message:`Rejected ${t.name}'s request to join stage.`,duration:v.webinar})},this.stageRequestAccepted=()=>{this.add({id:"stage-request-accepted",message:"Request to join accepted",duration:3e3})},this.stageRequestRejected=()=>{this.add({id:"stage-request-rejected",message:"Request to join rejected",duration:3e3})},this.newStageRequests=({count:e})=>{this.add({id:"new-stage-request",message:`You have ${e} pending request${1===e?"":"s"}`,duration:3e3})},this.stageStatusUpdateListener=t=>{"ON_STAGE"===t?this.addStagePeersListeners(e):this.removeStagePeersListeners(e)},this.socketReconnectedListener=()=>this.socketUpdateListener({event:"reconnected"}),this.socketDisconnectedListener=()=>this.socketUpdateListener({event:"disconnected"}),this.socketReconnectingListener=()=>this.socketUpdateListener({event:"reconnecting"}),this.socketFailureListener=()=>this.socketUpdateListener({event:"failed"}),this.socketReconnectFailureListener=({attempt:e})=>this.socketUpdateListener({event:"reconnectFailure",attempt:e});const L=e.self.getCurrentDevices();null!=L.speaker&&this.audio.setDevice(L.speaker.deviceId),m?null===(i=e.stage)||void 0===i||i.on("stageStatusUpdate",this.stageStatusUpdateListener):this.addStagePeersListeners(e),e.participants.joined.addListener("peerRequestToJoinStage",this.peerRequestToJoinStateListener),e.participants.joined.addListener("peerAcceptedToJoinStage",this.peerAcceptedToJoinStageListener),e.participants.joined.addListener("peerRejectedToJoinStage",this.peerRejectedToJoinStageListener),this.canAcceptWaitingRequests()&&e.participants.waitlisted.addListener("participantJoined",this.waitlistedParticipantJoinedListener),!(0,p.u)(e)&&(null===(n=e.chat)||void 0===n||n.addListener("chatUpdate",this.chatUpdateListener)),null===(s=e.polls)||void 0===s||s.addListener("pollsUpdate",this.pollUpdateListener),e.self.addListener("deviceUpdate",this.deviceUpdateListener),e.meta.addListener("socketReconnected",this.socketReconnectedListener),e.meta.addListener("socketDisconnected",this.socketDisconnectedListener),e.meta.addListener("socketReconnecting",this.socketReconnectingListener),e.meta.addListener("socketFailure",this.socketFailureListener),e.meta.addListener("socketReconnectFailure",this.socketReconnectFailureListener),null===(d=e.remote)||void 0===d||d.addListener("remoteUpdate",this.onRemoteUpdate),null===(c=e.spotlight)||void 0===c||c.addListener("activeTabUpdate",this.spotlightTabUpdateListener),null===(r=e.recording)||void 0===r||r.addListener("recordingUpdate",this.onRecordingUpdate),null===(l=e.stage)||void 0===l||l.addListener("stageRequestApproved",this.stageRequestAccepted),null===(u=e.stage)||void 0===u||u.addListener("stageRequestRejected",this.stageRequestRejected),e.self.permissions.acceptPresentRequests&&(null===(g=e.stage)||void 0===g||g.addListener("newStageRequest",this.newStageRequests))}configChanged(e){null!=e&&null!=(null==e?void 0:e.config)&&(this.permissions=function(e){const t=Object.assign({},u);return null==e||(Object.assign(t.notification_sounds,e.notification_sounds),Object.assign(t.notifications,e.notifications),Object.assign(t.notification_duration,e.notification_duration),t.participant_chat_message_sound_notification_limit=e.participant_chat_message_sound_notification_limit,t.participant_joined_sound_notification_limit=e.participant_joined_sound_notification_limit),t}(e.config),this.enabledSounds=g(this.permissions.notification_sounds))}statesChanged(e){var t;if(null!=e){const i=!(null===(t=null==e?void 0:e.prefs)||void 0===t?void 0:t.muteNotificationSounds);for(const e of this.enabledSounds)e in this.permissions.notification_sounds&&(this.permissions.notification_sounds[e]=i)}}apiErrorListener({detail:e}){const{trace:t,message:i}=e;this.add({id:t,message:i,duration:l,icon:this.iconPack.warning})}add(e){"visible"===document.visibilityState&&this.notifications.length<5&&(this.notifications=[...this.notifications,e])}remove(e){this.notifications=this.notifications.filter((t=>t.id!==e))}handleDismiss(e){e.stopPropagation();const t=e.detail,i=this.host.shadowRoot.querySelector(`[data-id="${t}"]`);null==i||i.classList.add("exit"),setTimeout((()=>{(0,n.w)((()=>{this.remove(t)}))}),400)}canPlayParticipantJoinedSound(){return null==this.permissions.participant_joined_sound_notification_limit||this.permissions.participant_joined_sound_notification_limit<=0||this.meeting.participants.count<=this.permissions.participant_joined_sound_notification_limit}canPlayChatSound(){return null==this.permissions.participant_chat_message_sound_notification_limit||this.permissions.participant_chat_message_sound_notification_limit<=0||this.meeting.participants.count<=this.permissions.participant_chat_message_sound_notification_limit}canAcceptWaitingRequests(){return this.permissions.notifications.participant_joined_waitlist&&this.meeting.self.permissions.acceptWaitingRequests}render(){return(0,n.h)(n.H,null,this.notifications.map((e=>(0,n.h)("dyte-notification",{size:this.size,key:e.id,"data-id":e.id,notification:e,onDyteNotificationDismiss:e=>this.handleDismiss(e),iconPack:this.iconPack,t:this.t}))))}get host(){return(0,n.g)(this)}static get watchers(){return{meeting:["meetingChanged"],config:["configChanged"],states:["statesChanged"]}}};m.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);position:absolute;top:var(--dyte-space-4, 16px);right:var(--dyte-space-4, 16px);bottom:var(--dyte-space-4, 16px);left:var(--dyte-space-4, 16px);top:auto;display:flex;flex-direction:column;pointer-events:none;z-index:100}dyte-notification{margin-top:var(--dyte-space-2, 8px)}"},579:(e,t,i)=>{i.d(t,{F:()=>s,i:()=>a,u:()=>o});var n=i(614);const s={PLAY_PARTICIPANT_TILE_VIDEO_ON_PAUSE:"play_participant_tile_video_on_pause",DISABLE_EMOJI_PICKER:"disable_emoji_picker",FEAT_PAGINATED_CHAT:"feat_paginated_chat",LOG_PLAYING_FAILURES:"log_playing_failures"},a=e=>e.connectedMeetings.supportsConnectedMeetings,o=e=>{var t;return(0,n.s)(e)||(null===(t=null==e?void 0:e.__internals__)||void 0===t?void 0:t.features.hasFeature("feat_paginated_chat"))}},6386:(e,t,i)=>{i.d(t,{l:()=>n});const n=console},1007:(e,t,i)=>{i.d(t,{D:()=>a});var n=i(6386);const s={joined:"https://dyte-uploads.s3.ap-south-1.amazonaws.com/notification_join.mp3",left:"https://dyte-uploads.s3.ap-south-1.amazonaws.com/notification_join.mp3",message:"https://dyte-uploads.s3.ap-south-1.amazonaws.com/notification_message.mp3"};class a{constructor(){this.audio=document.createElement("audio"),this.audio.volume=.3}play(e,t=3e3){var i;this.playing||(this.playing=!0,this.audio.src=s[e],this.audio.volume=.3,null===(i=this.audio.play())||void 0===i||i.catch((i=>{n.l.error("[dyte-notifications] play() failed\n",{sound:e,duration:t},i)})),setTimeout((()=>{this.playing=!1}),t))}async setDevice(e){var t,i,s;await(null===(s=null===(i=null===(t=this.audio)||void 0===t?void 0:t.setSinkId)||void 0===i?void 0:i.call(t,e))||void 0===s?void 0:s.catch((e=>{n.l.error("[dyte-notifications] setSinkId() error\n",e)})))}}}}]);